<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnHa TicTacToe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .animate-pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* Custom checkbox style for sound toggle */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3B82F6;
        }
        
        .toggle-checkbox:checked + .toggle-label {
            background-color: #3B82F6;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Audio element for background music -->
    <audio id="bgMusic" loop>
        <source src="bgMusic.mp3" type="audio/mpeg">
    </audio>

    <!-- Main container -->
    <div class="container mx-auto px-4 py-8 flex flex-col items-center">
        <!-- Header -->
        <header class="w-full mb-10 text-center animate-fade-in">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-600">
                EnHa TICTACTOE
            </h1>
            <p class="text-xl text-gray-300">Created with ‚ù§ by Alif F.P</p>
        </header>

        <!-- Authentication View (initial view) -->
        <div id="authView" class="w-full max-w-md bg-gray-800 rounded-lg shadow-xl p-8 animate-fade-in">
            <div id="loginForm">
                <h2 class="text-2xl font-bold mb-6 text-center">Login to Play</h2>
                <div class="mb-4">
                    <label class="block text-gray-300 mb-2" for="loginUsername">Username</label>
                    <input id="loginUsername" type="text" class="w-full px-4 py-2 rounded bg-gray-700 border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2" for="loginPassword">Password</label>
                    <input id="loginPassword" type="password" class="w-full px-4 py-2 rounded bg-gray-700 border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <button id="loginBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded mb-4 transition duration-300">
                    Login
                </button>
                <p class="text-center text-gray-400 mb-2">Don't have an account?</p>
                <button id="showSignupBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300">
                    Create Account
                </button>
            </div>

            <div id="signupForm" class="hidden">
                <h2 class="text-2xl font-bold mb-6 text-center">Create Account</h2>
                <div class="mb-4">
                    <label class="block text-gray-300 mb-2" for="signupUsername">Username</label>
                    <input id="signupUsername" type="text" class="w-full px-4 py-2 rounded bg-gray-700 border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-300 mb-2" for="signupEmail">Email</label>
                    <input id="signupEmail" type="email" class="w-full px-4 py-2 rounded bg-gray-700 border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-300 mb-2" for="signupPassword">Password</label>
                    <input id="signupPassword" type="password" class="w-full px-4 py-2 rounded bg-gray-700 border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2" for="signupConfirmPassword">Confirm Password</label>
                    <input id="signupConfirmPassword" type="password" class="w-full px-4 py-2 rounded bg-gray-700 border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <button id="signupBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded mb-4 transition duration-300">
                    Sign Up
                </button>
                <button id="showLoginBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300">
                    Back to Login
                </button>
            </div>
        </div>

        <!-- Loading View -->
        <div id="loadingView" class="hidden w-full max-w-md text-center">
            <div class="flex justify-center mb-6">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
            </div>
            <h2 class="text-2xl font-bold mb-2">Authenticating...</h2>
            <p class="text-gray-400">Please wait while we verify your credentials</p>
        </div>

        <!-- Main Menu (after login) -->
        <div id="mainMenu" class="hidden w-full max-w-md bg-gray-800 rounded-lg shadow-xl p-8">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-bold">Welcome, <span id="usernameDisplay" class="text-blue-400">Player</span></h2>
                <div class="flex items-center">
                    <span class="mr-2 text-sm">Music</span>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                        <input type="checkbox" id="musicToggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" checked>
                        <label for="musicToggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <button id="pvpBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition duration-300 flex items-center justify-between">
                    <span>Player vs Player</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="statsBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg transition duration-300 flex items-center justify-between">
                    <span>My Stats</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
                    </svg>
                </button>
                <button id="logoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition duration-300 flex items-center justify-between">
                    <span>Logout</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- PvP Room Selection -->
        <div id="pvpView" class="hidden w-full max-w-md bg-gray-800 rounded-lg shadow-xl p-8">
            <h2 class="text-2xl font-bold mb-6 text-center">Player vs Player Rooms</h2>
            
            <div class="mb-6 flex space-x-4">
                <button id="createRoomBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition duration-300">
                    Create New Room
                </button>
                <button id="refreshRoomsBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300">
                    Refresh Rooms
                </button>
            </div>
            
            <div id="roomList" class="space-y-2 mb-6">
                <!-- Room items will be added here dynamically -->
                <div class="text-center py-4 text-gray-500">Loading rooms...</div>
            </div>
            
            <button id="backToMenuBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300">
                Back to Menu
            </button>
        </div>

        <!-- Game View -->
        <div id="gameView" class="hidden w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <div id="playerX" class="text-lg font-bold px-4 py-2 rounded-lg bg-gray-700">
                    Player X: <span id="playerXName" class="text-blue-400">Waiting...</span>
                </div>
                <div id="playerO" class="text-lg font-bold px-4 py-2 rounded-lg bg-gray-700">
                    Player O: <span id="playerOName" class="text-red-400">Waiting...</span>
                </div>
            </div>
            
            <div id="gameStatus" class="text-center mb-6 text-xl font-bold animate-pulse">
                Waiting for players...
            </div>
            
            <div class="bg-gray-800 rounded-lg p-4 shadow-xl mb-6">
                <div id="gameBoard" class="grid grid-cols-3 grid-rows-3 gap-2 w-full aspect-square">
                    <!-- Game board cells will be added dynamically -->
                    <% for(let i = 0; i < 9; i++) { %>
                        <div class="cell bg-gray-700 rounded-lg flex items-center justify-center text-5xl font-bold cursor-pointer hover:bg-gray-600 transition duration-200" data-index="<%= i %>"></div>
                    <% } %>
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button id="leaveGameBtn" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded transition duration-300">
                    Leave Game
                </button>
                <button id="rematchBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300 hidden">
                    Rematch
                </button>
            </div>
        </div>

        <!-- Stats View -->
        <div id="statsView" class="hidden w-full max-w-md bg-gray-800 rounded-lg shadow-xl p-8">
            <h2 class="text-2xl font-bold mb-6 text-center border-b pb-2 border-gray-700">Player Statistics</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-xl font-bold" id="totalGames">0</div>
                    <div class="text-gray-400">Total Games</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-xl font-bold" id="wins">0</div>
                    <div class="text-gray-400">Wins</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-xl font-bold" id="losses">0</div>
                    <div class="text-gray-400">Losses</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-xl font-bold" id="draws">0</div>
                    <div class="text-gray-400">Draws</div>
                </div>
            </div>
            
            <h3 class="text-xl font-bold mb-4 border-b pb-2 border-gray-700">Recent Matches</h3>
            <div id="recentMatches">
                <div class="text-center py-4 text-gray-500">No recent matches</div>
            </div>
            
            <button id="backToMenuBtnStats" class="w-full mt-6 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300">
                Back to Menu
            </button>
        </div>
    </div>

    <script>
        // Game state
        const game = {
            isLoggedIn: false,
            currentUser: null,
            currentRoom: null,
            board: ['', '', '', '', '', '', '', '', ''],
            currentPlayer: 'X',
            gameActive: false,
            rooms: [],
            socket: null,
            boardElement: null,
            statusElement: null,
            cells: [],
            bgMusic: null
        };

        // DOM Elements
        const views = {
            auth: document.getElementById('authView'),
            loading: document.getElementById('loadingView'),
            mainMenu: document.getElementById('mainMenu'),
            pvp: document.getElementById('pvpView'),
            game: document.getElementById('gameView'),
            stats: document.getElementById('statsView')
        };

        // Authentication elements
        const authElements = {
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            loginUsername: document.getElementById('loginUsername'),
            loginPassword: document.getElementById('loginPassword'),
            signupUsername: document.getElementById('signupUsername'),
            signupEmail: document.getElementById('signupEmail'),
            signupPassword: document.getElementById('signupPassword'),
            signupConfirmPassword: document.getElementById('signupConfirmPassword'),
            loginBtn: document.getElementById('loginBtn'),
            signupBtn: document.getElementById('signupBtn'),
            showSignupBtn: document.getElementById('showSignupBtn'),
            showLoginBtn: document.getElementById('showLoginBtn')
        };

        // Menu elements
        const menuElements = {
            usernameDisplay: document.getElementById('usernameDisplay'),
            pvpBtn: document.getElementById('pvpBtn'),
            statsBtn: document.getElementById('statsBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            musicToggle: document.getElementById('musicToggle')
        };

        // PvP elements
        const pvpElements = {
            createRoomBtn: document.getElementById('createRoomBtn'),
            refreshRoomsBtn: document.getElementById('refreshRoomsBtn'),
            roomList: document.getElementById('roomList'),
            backToMenuBtn: document.getElementById('backToMenuBtn')
        };

        // Game elements
        const gameElements = {
            playerXName: document.getElementById('playerXName'),
            playerOName: document.getElementById('playerOName'),
            gameStatus: document.getElementById('gameStatus'),
            gameBoard: document.getElementById('gameBoard'),
            leaveGameBtn: document.getElementById('leaveGameBtn'),
            rematchBtn: document.getElementById('rematchBtn'),
            board: document.querySelectorAll('.cell')
        };

        // Stats elements
        const statsElements = {
            totalGames: document.getElementById('totalGames'),
            wins: document.getElementById('wins'),
            losses: document.getElementById('losses'),
            draws: document.getElementById('draws'),
            recentMatches: document.getElementById('recentMatches'),
            backToMenuBtn: document.getElementById('backToMenuBtnStats')
        };

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize background music
            game.bgMusic = document.getElementById('bgMusic');
            
            // Setup event listeners
            setupAuthListeners();
            setupMenuListeners();
            setupPvPListeners();
            setupGameListeners();
            setupStatsListeners();
            
            // Check if user is already logged in (for demo)
            checkLoginStatus();
        });

        // Check login status (simulated with localStorage for demo)
        function checkLoginStatus() {
            const user = localStorage.getItem('tic-tac-toe-user');
            if (user) {
                game.currentUser = JSON.parse(user);
                game.isLoggedIn = true;
                showMainMenu();
            } else {
                showAuthView();
            }
        }

        // Show authentication view
        function showAuthView() {
            hideAllViews();
            views.auth.classList.remove('hidden');
        }

        // Show loading view
        function showLoadingView(message = 'Authenticating...') {
            hideAllViews();
            views.loading.classList.remove('hidden');
            views.loading.querySelector('h2').textContent = message;
        }

        // Show main menu
        function showMainMenu() {
            hideAllViews();
            menuElements.usernameDisplay.textContent = game.currentUser.username;
            views.mainMenu.classList.remove('hidden');
            
            // Start background music if toggle is on
            if (menuElements.musicToggle.checked) {
                game.bgMusic.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // Show PvP view
        function showPvPView() {
            hideAllViews();
            views.pvp.classList.remove('hidden');
            refreshRooms();
        }

        // Show game view
        function showGameView() {
            hideAllViews();
            views.game.classList.remove('hidden');
            initializeBoard();
        }

        // Show stats view
        function showStatsView() {
            hideAllViews();
            views.stats.classList.remove('hidden');
            loadStats();
        }

        // Hide all views
        function hideAllViews() {
            Object.values(views).forEach(view => view.classList.add('hidden'));
        }

        // Initialize game board
        function initializeBoard() {
            game.board = ['', '', '', '', '', '', '', '', ''];
            game.gameActive = true;
            game.currentPlayer = 'X';
            
            gameElements.board.forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('text-blue-400', 'text-red-400');
                
                // Reset cell click handlers
                cell.onclick = handleCellClick;
            });
            
            updateGameStatus();
        }

        // Update game status text
        function updateGameStatus() {
            if (!game.gameActive) {
                gameElements.gameStatus.textContent = 'Game Over';
                return;
            }
            
            gameElements.gameStatus.textContent = `Player ${game.currentPlayer}'s turn`;
        }

        // Handle cell click
        function handleCellClick(e) {
            const index = parseInt(e.target.getAttribute('data-index'));
            
            // Validate move
            if (game.board[index] !== '' || !game.gameActive) return;
            
            // In a real app, this would send the move to the server
            makeMove(index, game.currentPlayer);
        }

        // Make a move
        function makeMove(index, player) {
            // Update board state
            game.board[index] = player;
            const cell = gameElements.board[index];
            
            // Update UI
            cell.textContent = player;
            cell.classList.add(player === 'X' ? 'text-blue-400' : 'text-red-400');
            cell.onclick = null; // Disable further clicks
            
            // Check for winner or draw
            if (checkWin()) {
                game.gameActive = false;
                gameElements.gameStatus.textContent = `Player ${player} wins!`;
                gameElements.rematchBtn.classList.remove('hidden');
                return;
            }
            
            if (checkDraw()) {
                game.gameActive = false;
                gameElements.gameStatus.textContent = `It's a draw!`;
                gameElements.rematchBtn.classList.remove('hidden');
                return;
            }
            
            // Switch player
            game.currentPlayer = player === 'X' ? 'O' : 'X';
            updateGameStatus();
        }

        // Check for win
        function checkWin() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6]             // diagonals
            ];
            
            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                return game.board[a] && 
                       game.board[a] === game.board[b] && 
                       game.board[a] === game.board[c];
            });
        }

        // Check for draw
        function checkDraw() {
            return game.board.every(cell => cell !== '');
        }

        // Refresh rooms list
        function refreshRooms() {
            // Simulate API call with setTimeout
            setTimeout(() => {
                // Mock rooms data
                game.rooms = [
                    { id: 'room1', name: 'Quick Match', players: 1, maxPlayers: 2 },
                    { id: 'room2', name: 'Tournament #1', players: 2, maxPlayers: 2 },
                    { id: 'room3', name: 'Fun Room', players: 1, maxPlayers: 2 }
                ];
                
                updateRoomList();
            }, 500);
        }

        // Update room list UI
        function updateRoomList() {
            pvpElements.roomList.innerHTML = '';
            
            if (game.rooms.length === 0) {
                pvpElements.roomList.innerHTML = '<div class="text-center py-4 text-gray-500">No rooms available</div>';
                return;
            }
            
            game.rooms.forEach(room => {
                const roomElement = document.createElement('div');
                roomElement.className = 'bg-gray-700 rounded-lg p-4 flex justify-between items-center';
                roomElement.innerHTML = `
                    <div>
                        <h3 class="font-bold">${room.name}</h3>
                        <p class="text-sm text-gray-400">Players: ${room.players}/${room.maxPlayers}</p>
                    </div>
                    <button class="join-room-btn bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm" data-room-id="${room.id}">
                        Join ${room.players < room.maxPlayers ? 'Room' : 'Spectate'}
                    </button>
                `;
                
                pvpElements.roomList.appendChild(roomElement);
            });
            
            // Add click handlers to join buttons
            document.querySelectorAll('.join-room-btn').forEach(btn => {
                btn.onclick = function() {
                    const roomId = this.getAttribute('data-room-id');
                    joinRoom(roomId);
                };
            });
        }

        // Join a room
        function joinRoom(roomId) {
            const room = game.rooms.find(r => r.id === roomId);
            if (!room) return;
            
            if (room.players >= room.maxPlayers) {
                alert('Room is full');
                return;
            }
            
            game.currentRoom = room;
            
            // Simulate joining a room - in reality this would be done via WebSocket
            showGameView();
            
            // Mock player names
            gameElements.playerXName.textContent = game.currentUser.username;
            gameElements.playerOName.textContent = 'Opponent';
            
            setTimeout(() => {
                gameElements.gameStatus.textContent = "Your turn (X)";
            }, 1000);
        }

        // Create a new room
        function createRoom() {
            const roomName = prompt('Enter room name:');
            if (!roomName) return;
            
            // Simulate room creation
            const newRoom = {
                id: 'room' + Date.now(),
                name: roomName,
                players: 1,
                maxPlayers: 2
            };
            
            game.rooms.unshift(newRoom);
            updateRoomList();
            
            // Automatically join the new room
            joinRoom(newRoom.id);
        }

        // Load player stats
        function loadStats() {
            // Simulate loading stats from server
            setTimeout(() => {
                // Mock data
                statsElements.totalGames.textContent = '24';
                statsElements.wins.textContent = '10';
                statsElements.losses.textContent = '8';
                statsElements.draws.textContent = '6';
                
                const matches = [
                    { opponent: 'player1', result: 'Won', date: '2023-05-15' },
                    { opponent: 'player2', result: 'Lost', date: '2023-05-14' },
                    { opponent: 'player3', result: 'Draw', date: '2023-05-12' },
                    { opponent: 'player4', result: 'Won', date: '2023-05-10' }
                ];
                
                let matchesHtml = '';
                matches.forEach(match => {
                    matchesHtml += `
                        <div class="bg-gray-700 rounded-lg p-3 mb-2 flex justify-between items-center">
                            <div>
                                <span class="font-bold">vs ${match.opponent}</span>
                                <span class="text-sm text-gray-400 ml-2">${match.date}</span>
                            </div>
                            <span class="px-2 py-1 rounded text-sm ${
                                match.result === 'Won' ? 'bg-green-600' :
                                match.result === 'Lost' ? 'bg-red-600' : 'bg-gray-600'
                            }">${match.result}</span>
                        </div>
                    `;
                });
                
                statsElements.recentMatches.innerHTML = matchesHtml || 
                    '<div class="text-center py-4 text-gray-500">No recent matches</div>';
            }, 800);
        }

        // Setup authentication event listeners
        function setupAuthListeners() {
            authElements.showSignupBtn.onclick = () => {
                authElements.loginForm.classList.add('hidden');
                authElements.signupForm.classList.remove('hidden');
            };
            
            authElements.showLoginBtn.onclick = () => {
                authElements.signupForm.classList.add('hidden');
                authElements.loginForm.classList.remove('hidden');
            };
            
            authElements.loginBtn.onclick = () => {
                const username = authElements.loginUsername.value.trim();
                const password = authElements.loginPassword.value.trim();
                
                if (!username || !password) {
                    alert('Please enter both username and password');
                    return;
                }
                
                showLoadingView();
                
                // Simulate login request
                setTimeout(() => {
                    // Mock login success
                    game.currentUser = {
                        id: 'user' + Date.now(),
                        username,
                        email: ''
                    };
                    
                    localStorage.setItem('tic-tac-toe-user', JSON.stringify(game.currentUser));
                    game.isLoggedIn = true;
                    
                    showMainMenu();
                    
                    // Reset form
                    authElements.loginUsername.value = '';
                    authElements.loginPassword.value = '';
                }, 1500);
            };
            
            authElements.signupBtn.onclick = () => {
                const username = authElements.signupUsername.value.trim();
                const email = authElements.signupEmail.value.trim();
                const password = authElements.signupPassword.value.trim();
                const confirmPassword = authElements.signupConfirmPassword.value.trim();
                
                if (!username || !email || !password || !confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    alert('Password must be at least 6 characters');
                    return;
                }
                
                showLoadingView('Creating account...');
                
                // Simulate signup request
                setTimeout(() => {
                    // Mock signup success
                    game.currentUser = {
                        id: 'user' + Date.now(),
                        username,
                        email
                    };
                    
                    localStorage.setItem('tic-tac-toe-user', JSON.stringify(game.currentUser));
                    game.isLoggedIn = true;
                    
                    showMainMenu();
                    
                    // Reset form
                    authElements.signupUsername.value = '';
                    authElements.signupEmail.value = '';
                    authElements.signupPassword.value = '';
                    authElements.signupConfirmPassword.value = '';
                }, 1500);
            };
        }

        // Setup menu event listeners
        function setupMenuListeners() {
            menuElements.pvpBtn.onclick = showPvPView;
            menuElements.statsBtn.onclick = showStatsView;
            
            menuElements.logoutBtn.onclick = () => {
                localStorage.removeItem('tic-tac-toe-user');
                game.currentUser = null;
                game.isLoggedIn = false;
                showAuthView();
                
                // Pause music when logging out
                game.bgMusic.pause();
            };
            
            menuElements.musicToggle.onchange = function() {
                if (this.checked) {
                    game.bgMusic.play().catch(e => console.log('Audio play failed:', e));
                } else {
                    game.bgMusic.pause();
                }
            };
        }

        // Setup PvP event listeners
        function setupPvPListeners() {
            pvpElements.createRoomBtn.onclick = createRoom;
            pvpElements.refreshRoomsBtn.onclick = refreshRooms;
            pvpElements.backToMenuBtn.onclick = showMainMenu;
        }

        // Setup game event listeners
        function setupGameListeners() {
            gameElements.leaveGameBtn.onclick = () => {
                if (confirm('Are you sure you want to leave the game?')) {
                    game.currentRoom = null;
                    showMainMenu();
                }
            };
            
            gameElements.rematchBtn.onclick = () => {
                gameElements.rematchBtn.classList.add('hidden');
                initializeBoard();
            };
        }

        // Setup stats event listeners
        function setupStatsListeners() {
            statsElements.backToMenuBtn.onclick = showMainMenu;
        }

        // In a real implementation, you would have WebSocket connections here
        // to handle real-time game updates between players in the same room
    </script>
</body>
</html>
